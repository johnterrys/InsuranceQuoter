@page "/policies"
@using Microsoft.AspNetCore.Authorization
@using InsuranceQuoter.Presentation.Ui.Models
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@attribute [Authorize]

<h1 class="page-title">Your Purchased Policies:</h1>

<table class="table table-bordered table-hover">
    <thead>
    <tr>
        <th scope="col">Registration Number</th>
        <th scope="col">Policy Reference</th>
        <th scope="col">Insurer</th>
        <th scope="col">Expires On</th>
        <th scope="col">Cover Type</th>
    </tr>
    </thead>
    <tbody>
    @if (Policies == null || !Policies.Any() && PoliciesRetrieving)
    {
        <tr>
            <td colspan="6">
                <div class="spinner-border" role="status">
                </div>
                <span>Loading purchased policies...</span>
            </td>
        </tr>
    }
    else if (Policies == null || !Policies.Any() && !PoliciesRetrieving)
    {
        <tr>
            <td colspan="6">
                You haven't purchased any policies yet.
            </td>
        </tr>
    }
    else
    {
    @foreach (PolicyModel policy in Policies)
    {
        <tr>
            <td>@policy.Registration</td>
            <td>@policy.PolicyUid</td>
            <td>@policy.Insurer</td>
            <td>@policy.ExpiresOn</td>
            <td>@policy.CoverType</td>
        </tr>
    }
    }
    </tbody>
</table>

@*<div class="form-group">
        <button class="btn btn-warning" type="button" @onclick="() => QuoteBackSelected()">Back</button>
    </div>
    @if (QuoteHasBeenSelected && ShowPaymentDialog)
    {
        <div class="modal fade show d-block" id="exampleModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="titleLabel">Pay for your policy</h5>
                        <button type="button" class="close" @onclick="CloseDialogSelected" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <EditForm Model="@PaymentModel" OnValidSubmit="HandleValidSubmit">
                            <DataAnnotationsValidator />
                            <ValidationSummary />

                            <div class="form-group">
                                <InputText id="cardNumber" class="form-control" @bind-Value="@PaymentModel.CardNumber" placeholder="Enter Card Number"></InputText>
                                <ValidationMessage For="@(() => PaymentModel.CardNumber)" />
                            </div>
                            <button type="submit" class="btn btn-success">Make Payment</button>
                        </EditForm>

                    </div>
                </div>
            </div>
        </div>*@